<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Login - Certificate Chain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #0d9488; /* Fallback */
            background-image: linear-gradient(to right bottom, #06b6d4, #22c55e); 
        }
        .login-card {
            background-image: linear-gradient(to right bottom, #6366f1, #ec4899); /* Blue to Pink gradient */
        }
        .login-button {
            background-image: linear-gradient(to right, #ec4899, #f97316); /* Pink to Orange gradient */
        }
    </style>
</head>
<body class="min-h-screen text-white flex flex-col items-center justify-center p-4">

    <header class="absolute top-0 left-0 right-0 p-6 z-10">
        <div class="max-w-7xl mx-auto">
            <a href="/index.html" class="flex items-center gap-3 text-lg font-bold text-white hover:opacity-80 transition-opacity">
                <i data-lucide="link" class="w-6 h-6"></i>
                <span>Certificate Chain</span>
            </a>
        </div>
    </header>

    <div class="login-card w-full max-w-md p-8 rounded-2xl shadow-2xl">
        <div class="text-center">
            <i data-lucide="graduation-cap" class="w-12 h-12 mx-auto text-white mb-4"></i>
            <h1 class="text-3xl font-bold text-white">Student Portal Login</h1>
            <p class="mt-2 text-sm text-white/80">Access your digital certificates registered on the blockchain.</p>
        </div>

        <form id="studentLoginForm" class="mt-8 space-y-6">
            <div id="statusMessage" class="hidden p-3 rounded-lg text-sm text-center font-semibold transition duration-150"></div>

            <div>
                <label for="rollNumber" class="block text-sm font-medium text-white/80">Roll Number</label>
                <input type="text" id="rollNumber" name="rollNumber" required placeholder="Enter your unique Roll Number"
                       class="mt-1 block w-full px-4 py-2 bg-white/20 border border-white/30 rounded-lg shadow-sm focus:ring-2 focus:ring-white focus:outline-none placeholder-white/50 transition">
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-white/80">Password</label>
                <input type="password" id="password" name="password" required placeholder="********"
                       class="mt-1 block w-full px-4 py-2 bg-white/20 border border-white/30 rounded-lg shadow-sm focus:ring-2 focus:ring-white focus:outline-none placeholder-white/50 transition">
            </div>

            <div>
                <button type="submit" id="loginButton"
                        class="login-button w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-base font-bold text-white hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-400 transition disabled:opacity-70">
                    <span id="buttonText">Sign In</span>
                    <svg id="loadingSpinner" class="hidden animate-spin ml-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </div>
        </form>

        <div class="mt-6 text-center">
            <a href="/admin/admin_dashboard.html" class="text-xs text-white/60 hover:text-white transition">
                Are you an Admin? Click here.
            </a>
        </div>
    </div>

    <script>
        window.onload = () => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        };

        const form = document.getElementById('studentLoginForm');
        const statusMessage = document.getElementById('statusMessage');
        const loginButton = document.getElementById('loginButton');
        const buttonText = document.getElementById('buttonText');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const rollNumberInput = document.getElementById('rollNumber');
        const passwordInput = document.getElementById('password');

        const urlParams = new URLSearchParams(window.location.search);
        const urlRollNumber = urlParams.get('rollNumber');
        if (urlRollNumber) rollNumberInput.value = urlRollNumber;
        const urlPassword = urlParams.get('password');
        if (urlPassword) passwordInput.value = urlPassword;
        
        // START: MODIFIED FUNCTION FOR NEW THEME
        function showStatus(message, isSuccess) {
            statusMessage.textContent = message;
            // Use classes that work on a dark/gradient background
            statusMessage.className = `p-3 rounded-lg text-sm text-center font-semibold ${isSuccess ? 'bg-green-500/80 text-white' : 'bg-red-500/80 text-white'}`;
        }
        // END: MODIFIED FUNCTION

        function toggleLoading(isLoading) {
            loginButton.disabled = isLoading;
            if (isLoading) {
                buttonText.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');
            } else {
                buttonText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
            }
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            toggleLoading(true);
            statusMessage.classList.add('hidden');

            const rollNumber = rollNumberInput.value.trim();
            const password = passwordInput.value;

            if (!rollNumber || !password) {
                 showStatus('Please enter both Roll Number and Password.', false);
                 toggleLoading(false);
                 return;
            }

            try {
                const response = await fetch('/api/student/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ rollNumber, password }),
                });

                const result = await response.json();

                if (result.success) {
                    showStatus('Login successful! Redirecting...', true);
                    sessionStorage.setItem('studentRollNumber', rollNumber); 
                    setTimeout(() => {
                        window.location.href = 'student_dashboard.html'; 
                    }, 500);

                } else {
                    showStatus(result.message || 'Login failed. Please check your credentials.', false);
                }

            } catch (error) {
                console.error('Network or system error:', error);
                showStatus('Network error: Could not connect to the server.', false);
            } finally {
                toggleLoading(false);
            }
        });
    </script>
</body>
</html>